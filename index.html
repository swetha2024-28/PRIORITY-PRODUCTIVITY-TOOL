<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Task Prioritizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom icons using CSS */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            margin-right: 0.5em;
        }
        .icon-target:before { content: "üéØ"; }
        .icon-clock:before { content: "‚è∞"; }
        .icon-calendar:before { content: "üìÖ"; }
        .icon-zap:before { content: "‚ö°"; }
        .icon-plus:before { content: "‚ûï"; }
        .icon-check:before { content: "‚úÖ"; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, createElement: e } = React;

        const SmartTaskPrioritizer = () => {
          // Load tasks from localStorage on component mount
          const [tasks, setTasks] = useState(() => {
            try {
              const savedTasks = localStorage.getItem('smartTaskPrioritizer-tasks');
              return savedTasks ? JSON.parse(savedTasks) : [];
            } catch (error) {
              console.error('Error loading tasks:', error);
              return [];
            }
          });
          const [showAddTask, setShowAddTask] = useState(false);
          const [availableTime, setAvailableTime] = useState('');
          const [suggestions, setSuggestions] = useState([]);
          
          const [newTask, setNewTask] = useState({
            name: '',
            description: '',
            timeRequired: '',
            difficulty: 1,
            deadline: '',
            priorityType: 'want',
            taskType: 'atomic',
            minChunkSize: 15,
            completed: false,
            timeSpent: 0
          });

          // Save tasks to localStorage whenever tasks change
          useEffect(() => {
            try {
              localStorage.setItem('smartTaskPrioritizer-tasks', JSON.stringify(tasks));
            } catch (error) {
              console.error('Error saving tasks:', error);
            }
          }, [tasks]);

          // Calculate task score
          const calculateScore = (task) => {
            const now = new Date();
            const deadline = new Date(task.deadline);
            const daysUntilDeadline = Math.max(0, (deadline - now) / (1000 * 60 * 60 * 24));
            
            // Base scores
            let score = 0;
            
            // Urgency score (higher for closer deadlines)
            const urgencyScore = Math.max(0, 100 - daysUntilDeadline * 10);
            score += urgencyScore;
            
            // Priority type bonus
            score += task.priorityType === 'must' ? 50 : 0;
            
            // Difficulty consideration (easier tasks get slight bonus for quick wins)
            score += (6 - task.difficulty) * 5;
            
            // Progress bonus for breakable tasks
            if (task.taskType === 'breakable' && task.timeSpent > 0) {
              const progressRatio = task.timeSpent / task.timeRequired;
              score += progressRatio * 30; // Bonus for continuing work
            }
            
            return Math.round(score);
          };

          // Get task suggestions based on available time
          const getTaskSuggestions = (minutes) => {
            const availableMinutes = parseInt(minutes);
            if (!availableMinutes) return [];
            
            const incompleteTasks = tasks.filter(task => !task.completed);
            
            const suitableTasks = incompleteTasks.filter(task => {
              if (task.taskType === 'atomic') {
                // Atomic tasks need full time
                return task.timeRequired <= availableMinutes;
              } else {
                // Breakable tasks need at least minimum chunk size
                const remainingTime = task.timeRequired - task.timeSpent;
                return remainingTime > 0 && task.minChunkSize <= availableMinutes;
              }
            });
            
            // Sort by calculated score (highest first)
            return suitableTasks
              .map(task => ({ ...task, score: calculateScore(task) }))
              .sort((a, b) => b.score - a.score)
              .slice(0, 3); // Top 3 suggestions
          };

          const addTask = () => {
            if (newTask.name && newTask.timeRequired && newTask.deadline) {
              setTasks([...tasks, { 
                ...newTask, 
                id: Date.now(),
                timeRequired: parseInt(newTask.timeRequired),
                minChunkSize: parseInt(newTask.minChunkSize)
              }]);
              setNewTask({
                name: '',
                description: '',
                timeRequired: '',
                difficulty: 1,
                deadline: '',
                priorityType: 'want',
                taskType: 'atomic',
                minChunkSize: 15,
                completed: false,
                timeSpent: 0
              });
              setShowAddTask(false);
            }
          };

          const markTaskComplete = (taskId) => {
            setTasks(tasks.map(task => 
              task.id === taskId ? { ...task, completed: true } : task
            ));
          };

          const workOnTask = (taskId, minutesWorked) => {
            setTasks(tasks.map(task => {
              if (task.id === taskId) {
                const newTimeSpent = task.timeSpent + minutesWorked;
                return { 
                  ...task, 
                  timeSpent: newTimeSpent,
                  completed: newTimeSpent >= task.timeRequired
                };
              }
              return task;
            }));
          };

          useEffect(() => {
            if (availableTime) {
              setSuggestions(getTaskSuggestions(availableTime));
            } else {
              setSuggestions([]);
            }
          }, [availableTime, tasks]);

          const formatDeadline = (deadline) => {
            const date = new Date(deadline);
            const now = new Date();
            const diffDays = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return '‚ö†Ô∏è Overdue';
            if (diffDays === 0) return 'üî• Due today';
            if (diffDays === 1) return '‚ö° Due tomorrow';
            return `üìÖ ${diffDays} days left`;
          };

          return e('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6" },
            e('div', { className: "max-w-4xl mx-auto" },
              e('h1', { className: "text-4xl font-bold text-gray-800 mb-8 text-center" },
                e('span', { className: "icon icon-target" }),
                "Smart Task Prioritizer"
              ),

              // Quick Time Input
              e('div', { className: "bg-white rounded-xl shadow-lg p-6 mb-6" },
                e('h2', { className: "text-xl font-semibold mb-4 flex items-center" },
                  e('span', { className: "icon icon-clock" }),
                  "I have some free time!"
                ),
                e('div', { className: "flex gap-4 items-center" },
                  e('input', {
                    type: "number",
                    placeholder: "Minutes available",
                    value: availableTime,
                    onChange: (event) => setAvailableTime(event.target.value),
                    className: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  }),
                  e('span', { className: "text-gray-600" }, "minutes"),
                  availableTime && e('button', {
                    onClick: () => setAvailableTime(''),
                    className: "text-sm text-gray-500 hover:text-gray-700"
                  }, "Clear")
                )
              ),

              // Task Suggestions
              suggestions.length > 0 && e('div', { className: "bg-white rounded-xl shadow-lg p-6 mb-6" },
                e('h3', { className: "text-lg font-semibold mb-4 text-green-700" },
                  e('span', { className: "icon icon-zap" }),
                  `Perfect tasks for ${availableTime} minutes:`
                ),
                e('div', { className: "space-y-3" },
                  suggestions.map(task => 
                    e('div', { key: task.id, className: "border border-green-200 rounded-lg p-4 bg-green-50" },
                      e('div', { className: "flex justify-between items-start" },
                        e('div', {},
                          e('h4', { className: "font-semibold text-gray-800" }, task.name),
                          e('p', { className: "text-sm text-gray-600" }, task.description),
                          e('div', { className: "flex gap-4 text-xs text-gray-500 mt-1" },
                            e('span', {}, formatDeadline(task.deadline)),
                            e('span', {}, `Difficulty: ${task.difficulty}/5`),
                            e('span', { 
                              className: task.priorityType === 'must' ? 'text-red-600 font-semibold' : '' 
                            }, task.priorityType === 'must' ? 'MUST DO' : 'Want to do'),
                            task.taskType === 'breakable' && task.timeSpent > 0 && e('span', {
                              className: "text-indigo-600"
                            }, `${task.timeSpent}/${task.timeRequired} mins done`)
                          )
                        ),
                        e('div', { className: "text-right" },
                          e('div', { className: "text-lg font-bold text-green-700" },
                            `Score: ${task.score}`
                          ),
                          e('button', {
                            onClick: () => {
                              if (task.taskType === 'atomic') {
                                markTaskComplete(task.id);
                              } else {
                                const timeToWork = Math.min(parseInt(availableTime), task.timeRequired - task.timeSpent);
                                workOnTask(task.id, timeToWork);
                              }
                            },
                            className: "mt-2 px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700"
                          }, task.taskType === 'atomic' ? 'Complete' : 'Work on it')
                        )
                      )
                    )
                  )
                )
              ),

              // Add Task Button
              e('div', { className: "flex justify-between items-center mb-6" },
                e('h2', { className: "text-2xl font-semibold text-gray-800" }, "All Tasks"),
                e('button', {
                  onClick: () => setShowAddTask(!showAddTask),
                  className: "bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center"
                },
                  e('span', { className: "icon icon-plus" }),
                  "Add Task"
                )
              ),

              // Add Task Form
              showAddTask && e('div', { className: "bg-white rounded-xl shadow-lg p-6 mb-6" },
                e('h3', { className: "text-lg font-semibold mb-4" }, "Add New Task"),
                e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Task Name"),
                    e('input', {
                      type: "text",
                      value: newTask.name,
                      onChange: (event) => setNewTask({...newTask, name: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",
                      placeholder: "Enter task name"
                    })
                  ),
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Time Required (minutes)"),
                    e('input', {
                      type: "number",
                      value: newTask.timeRequired,
                      onChange: (event) => setNewTask({...newTask, timeRequired: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    })
                  ),
                  e('div', { className: "md:col-span-2" },
                    e('label', { className: "block text-sm font-medium mb-1" }, "Description"),
                    e('textarea', {
                      value: newTask.description,
                      onChange: (event) => setNewTask({...newTask, description: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",
                      rows: "2"
                    })
                  ),
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Difficulty (1-5)"),
                    e('select', {
                      value: newTask.difficulty,
                      onChange: (event) => setNewTask({...newTask, difficulty: parseInt(event.target.value)}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    },
                      [1,2,3,4,5].map(n => e('option', { key: n, value: n }, n))
                    )
                  ),
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Deadline"),
                    e('input', {
                      type: "date",
                      value: newTask.deadline,
                      onChange: (event) => setNewTask({...newTask, deadline: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    })
                  ),
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Priority Type"),
                    e('select', {
                      value: newTask.priorityType,
                      onChange: (event) => setNewTask({...newTask, priorityType: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    },
                      e('option', { value: "want" }, "Want to do"),
                      e('option', { value: "must" }, "Must do")
                    )
                  ),
                  e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Task Type"),
                    e('select', {
                      value: newTask.taskType,
                      onChange: (event) => setNewTask({...newTask, taskType: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    },
                      e('option', { value: "atomic" }, "Atomic (do in one go)"),
                      e('option', { value: "breakable" }, "Breakable (can split up)")
                    )
                  ),
                  newTask.taskType === 'breakable' && e('div', {},
                    e('label', { className: "block text-sm font-medium mb-1" }, "Min chunk size (minutes)"),
                    e('input', {
                      type: "number",
                      value: newTask.minChunkSize,
                      onChange: (event) => setNewTask({...newTask, minChunkSize: event.target.value}),
                      className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                    })
                  )
                ),
                e('div', { className: "flex gap-2 mt-4" },
                  e('button', {
                    onClick: addTask,
                    className: "bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700"
                  }, "Add Task"),
                  e('button', {
                    onClick: () => setShowAddTask(false),
                    className: "bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400"
                  }, "Cancel")
                )
              ),

              // Task List
              e('div', { className: "space-y-4" },
                tasks.map(task => 
                  e('div', { 
                    key: task.id, 
                    className: `bg-white rounded-xl shadow-lg p-6 ${task.completed ? 'opacity-60' : ''}` 
                  },
                    e('div', { className: "flex justify-between items-start" },
                      e('div', { className: "flex-1" },
                        e('div', { className: "flex items-center gap-2 mb-2" },
                          e('h3', { 
                            className: `text-lg font-semibold ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}` 
                          }, task.name),
                          task.completed && e('span', { className: "icon icon-check text-green-500" })
                        ),
                        task.description && e('p', { className: "text-gray-600 mb-2" }, task.description),
                        e('div', { className: "flex flex-wrap gap-4 text-sm" },
                          e('span', { className: "flex items-center" },
                            e('span', { className: "icon icon-clock" }),
                            task.taskType === 'breakable' ? 
                              `${task.timeSpent}/${task.timeRequired} mins` : 
                              `${task.timeRequired} mins`
                          ),
                          e('span', { className: "flex items-center" },
                            e('span', { className: "icon icon-calendar" }),
                            formatDeadline(task.deadline)
                          ),
                          e('span', {}, `Difficulty: ${task.difficulty}/5`),
                          e('span', { 
                            className: `px-2 py-1 rounded-full text-xs ${
                              task.priorityType === 'must' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'
                            }` 
                          }, task.priorityType === 'must' ? 'MUST DO' : 'Want to do'),
                          e('span', { 
                            className: `px-2 py-1 rounded-full text-xs ${
                              task.taskType === 'atomic' ? 'bg-purple-100 text-purple-800' : 'bg-orange-100 text-orange-800'
                            }` 
                          }, task.taskType === 'atomic' ? 'Atomic' : 'Breakable')
                        ),
                        task.taskType === 'breakable' && task.timeSpent > 0 && !task.completed && e('div', { className: "mt-3" },
                          e('div', { className: "w-full bg-gray-200 rounded-full h-2" },
                            e('div', { 
                              className: "bg-indigo-600 h-2 rounded-full", 
                              style: {width: `${(task.timeSpent / task.timeRequired) * 100}%`}
                            })
                          ),
                          e('p', { className: "text-xs text-gray-500 mt-1" },
                            `${Math.round((task.timeSpent / task.timeRequired) * 100)}% complete`
                          )
                        )
                      ),
                      e('div', { className: "text-right ml-4" },
                        e('div', { className: "text-xl font-bold text-indigo-600 mb-2" },
                          `Score: ${calculateScore(task)}`
                        ),
                        !task.completed && e('button', {
                          onClick: () => markTaskComplete(task.id),
                          className: "bg-green-600 text-white px-3 py-1 rounded-md text-sm hover:bg-green-700"
                        }, "Mark Complete")
                      )
                    )
                  )
                )
              ),

              tasks.length === 0 && e('div', { className: "text-center py-12" },
                e('span', { className: "icon icon-target text-6xl text-gray-300 block mx-auto mb-4" }),
                e('p', { className: "text-gray-500 text-lg" }, "No tasks yet. Add your first task to get started!")
              )
            )
          );
        };

        ReactDOM.render(e(SmartTaskPrioritizer), document.getElementById('root'));
    </script>
</body>
</html>
